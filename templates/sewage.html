<!DOCTYPE html>
<html>
  <head>
    <title>HPro Sewage - Video Player</title>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <style>
      /* Esconde o player inicialmente */
      #player-container {
        display: none;
      }
    </style>
    <script>
      function extractYouTubeId(url) {
        const regExp =
          /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
        const match = url.match(regExp);
        return match && match[2].length === 11 ? match[2] : null;
      }

      let currentVideo = null;

      function loadYouTubeAndPlay(videoUrl) {
        const videoId = extractYouTubeId(videoUrl);
        if (!videoId) {
          alert('URL do YouTube inv√°lida');
          return;
        }

        // Simplesmente abre no YouTube - BitDefender n√£o bloquear√°
        const youtubeUrl = `https://www.youtube.com/watch?v=${videoId}`;

        const answer = confirm(
          'üé¨ V√≠deo do YouTube detectado!\n\n' +
            'O v√≠deo ser√° aberto no YouTube em uma nova aba.\n\n' +
            'Dica: Para usar em modo flutuante (como no Teams):\n' +
            '1. Inicie o v√≠deo no YouTube\n' +
            '2. Clique com bot√£o direito no v√≠deo\n' +
            '3. Selecione "Picture-in-Picture"\n\n' +
            'Deseja abrir o v√≠deo?',
        );

        if (answer) {
          window.open(youtubeUrl, '_blank', 'noopener,noreferrer');
          console.log('V√≠deo aberto no YouTube! üé¨');
        }

        currentVideo = videoId;
      }
    </script>
    <style>
      html,
      body {
        font-family: Segoe UI, Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #252526;
        color: #ffffff;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      .menubar {
        background-color: #333333;
        padding: 2px 8px;
        border-bottom: 1px solid #3d3d3d;
        font-size: 12px;
      }
      .menubar span {
        color: #cccccc;
        padding: 4px 8px;
        cursor: default;
      }
      .menubar span:hover {
        background-color: #3d3d3d;
      }
      .toolbar {
        background-color: #2d2d2d;
        padding: 4px 8px;
        border-bottom: 1px solid #3d3d3d;
        display: flex;
        gap: 4px;
      }
      .toolbar button {
        background: transparent;
        border: none;
        color: #cccccc;
        padding: 2px 8px;
        font-size: 12px;
        cursor: pointer;
      }
      .toolbar button:hover {
        background-color: #3d3d3d;
      }
      .main-container {
        display: flex;
        flex: 1;
        overflow: hidden;
      }
      .sidebar {
        width: 250px;
        background-color: #252526;
        border-right: 1px solid #3d3d3d;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      .sidebar-header {
        padding: 8px;
        font-size: 11px;
        color: #cccccc;
        background-color: #2d2d2d;
        border-bottom: 1px solid #3d3d3d;
      }
      .sidebar-content {
        padding: 8px;
        flex: 1;
        font-size: 12px;
        color: #cccccc;
        overflow-y: auto;
      }
      .content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      .tab-bar {
        background-color: #2d2d2d;
        border-bottom: 1px solid #3d3d3d;
        display: flex;
        padding: 0 4px;
      }
      .tab {
        padding: 6px 16px;
        background-color: #1e1e1e;
        border-right: 1px solid #3d3d3d;
        font-size: 12px;
        color: #cccccc;
      }
      .status-bar {
        background-color: #007acc;
        padding: 2px 8px;
        font-size: 12px;
        color: white;
        display: flex;
        justify-content: space-between;
      }
      .url-input {
        background-color: #1e1e1e;
        padding: 8px;
        display: flex;
        gap: 8px;
        border-bottom: 1px solid #3d3d3d;
      }
      #youtube-url {
        flex: 1;
        padding: 4px 8px;
        background-color: #3c3c3c;
        border: 1px solid #3d3d3d;
        color: #d4d4d4;
        font-family: Consolas, monospace;
        font-size: 12px;
      }
      #youtube-url:focus {
        outline: none;
        border-color: #007acc;
      }
      button.watch {
        padding: 4px 12px;
        background-color: transparent;
        color: #cccccc;
        border: 1px solid #3d3d3d;
        cursor: pointer;
        font-size: 12px;
      }
      button.watch:hover {
        background-color: #2d2d2d;
      }
      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 14px;
      }
      ::-webkit-scrollbar-track {
        background: #1e1e1e;
      }
      ::-webkit-scrollbar-thumb {
        background: #424242;
        border: 3px solid #1e1e1e;
        border-radius: 7px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #4f4f4f;
      }

      /* Video Container */
      #video-container {
        display: none;
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #1e1e1e;
        border: 1px solid #3d3d3d;
        border-radius: 4px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }

      .video-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 8px;
        background: #2d2d2d;
        border-bottom: 1px solid #3d3d3d;
      }

      .video-title {
        color: #cccccc;
        font-size: 12px;
        margin-right: 16px;
      }

      .video-controls {
        display: flex;
        gap: 8px;
      }

      .control-button {
        background: none;
        border: none;
        color: #cccccc;
        cursor: pointer;
        padding: 2px 6px;
        font-size: 12px;
      }

      .control-button:hover {
        background: #3d3d3d;
      }

      #pip-video {
        width: 400px;
        height: 225px;
        background: #000;
        border: none;
      }

      /* Design Responsivo */
      @media (max-width: 768px) {
        .menubar,
        .toolbar,
        .sidebar {
          display: none;
        }

        .main-container {
          flex-direction: column;
        }

        .content {
          width: 100%;
        }

        #video-container {
          bottom: 10px;
          right: 10px;
          left: 10px;
          width: auto;
        }

        #pip-video {
          width: 100%;
          height: 200px;
        }

        .url-input {
          padding: 12px;
        }

        #youtube-url {
          height: 40px;
          font-size: 16px;
        }

        button.watch {
          padding: 8px 16px;
          font-size: 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="menubar">
      <span>Arquivo</span>
      <span>Editar</span>
      <span>Visualizar</span>
      <span>Projeto</span>
      <span>Depurar</span>
      <span>Ferramentas</span>
      <span>Ajuda</span>
    </div>
    <div class="toolbar">
      <button>‚ñ∂ Executar</button>
      <button>‚è∏ Pausar</button>
      <button>‚èπ Parar</button>
      <button>‚Üª Reiniciar</button>
    </div>
    <div class="main-container">
      <div class="sidebar">
        <div class="sidebar-header">ESTRUTURA DO PROJETO</div>
        <div class="sidebar-content">
          üìÅ src<br />
          ‚î£ üìÅ components<br />
          ‚î£ üìÅ services<br />
          ‚îó üìÅ utils
        </div>
      </div>
      <script>
        function watchVideo() {
          const urlInput = document.getElementById('youtube-url');
          const url = urlInput.value.trim();

          if (!url) {
            alert('Por favor, cole uma URL do YouTube');
            return;
          }

          console.log('Carregando v√≠deo... üé¨');
          loadYouTubeAndPlay(url);
        }
      </script>

      <div class="content">
        <div class="tab-bar">
          <div class="tab">Video Player</div>
        </div>
        <div class="url-input">
          <input
            type="text"
            id="youtube-url"
            placeholder="Cole aqui o link do YouTube..."
          />
          <button class="watch" onclick="watchVideo()">Assistir</button>
        </div>
        <div id="video-container">
          <div class="video-header">
            <span class="video-title">YouTube Player</span>
            <div class="video-controls">
              <button class="control-button" onclick="togglePiP()">üì∫</button>
              <button class="control-button" onclick="minimizeVideo()">
                _
              </button>
              <button class="control-button" onclick="closeVideo()">‚úï</button>
            </div>
          </div>
          <video id="pip-video" controls></video>
        </div>
      </div>
    </div>
    <div class="status-bar">
      <div>Video Player</div>
      <div>Terminal: 1</div>
      <div id="current-user"></div>
    </div>

    <script>
      // Verifica se o usu√°rio est√° logado
      const username = localStorage.getItem('chatUsername');
      if (!username) {
        window.location.href = '/login';
      }

      // Atualiza o nome do usu√°rio na barra de status
      document.getElementById(
        'current-user',
      ).textContent = `Usu√°rio: ${username}`;

      let isMinimized = false;
      let originalHeight;

      function getYouTubeVideoId(url) {
        const regExp =
          /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
        const match = url.match(regExp);
        return match && match[2].length === 11 ? match[2] : null;
      }

      function loadYouTubeAndPlay(videoUrl) {
        const videoId = getYouTubeVideoId(videoUrl);
        if (!videoId) {
          alert('URL do YouTube inv√°lida');
          return;
        }

        // Simplesmente abre no YouTube - BitDefender n√£o bloquear√°
        const youtubeUrl = `https://www.youtube.com/watch?v=${videoId}`;

        const answer = confirm(
          'üé¨ V√≠deo do YouTube detectado!\n\n' +
            'O v√≠deo ser√° aberto no YouTube em uma nova aba.\n\n' +
            'Dica: Para usar em modo flutuante (como no Teams):\n' +
            '1. Inicie o v√≠deo no YouTube\n' +
            '2. Clique com bot√£o direito no v√≠deo\n' +
            '3. Selecione "Picture-in-Picture"\n\n' +
            'Deseja abrir o v√≠deo?',
        );

        if (answer) {
          window.open(youtubeUrl, '_blank', 'noopener,noreferrer');
          console.log('V√≠deo aberto no YouTube! üé¨');
        }
      }

      function watchVideo() {
        const urlInput = document.getElementById('youtube-url');
        const url = urlInput.value.trim();

        if (!url) {
          alert('Por favor, cole uma URL do YouTube');
          return;
        }

        console.log('Carregando v√≠deo... üé¨');
        loadYouTubeAndPlay(url);
      }

      function togglePiP() {
        const video = document.getElementById('pip-video');

        if (document.pictureInPictureElement) {
          document.exitPictureInPicture();
        } else if (document.pictureInPictureEnabled) {
          video.requestPictureInPicture().catch((err) => {
            console.error('Erro ao ativar PiP:', err);
          });
        }
      }

      function closeVideo() {
        const container = document.getElementById('video-container');
        const video = document.getElementById('pip-video');

        container.style.display = 'none';
        video.pause();
        video.src = '';
        isMinimized = false;

        if (document.pictureInPictureElement) {
          document.exitPictureInPicture();
        }
      }

      function minimizeVideo() {
        const container = document.getElementById('video-container');
        const video = document.getElementById('pip-video');

        if (!isMinimized) {
          originalHeight = video.style.height;
          container.style.height = '32px';
          video.style.display = 'none';
        } else {
          container.style.height = 'auto';
          video.style.display = 'block';
        }

        isMinimized = !isMinimized;
      }

      // Permite iniciar v√≠deo com Enter
      document
        .getElementById('youtube-url')
        .addEventListener('keypress', function (e) {
          if (e.key === 'Enter') {
            watchVideo();
          }
        });
    </script>
  </body>
</html>
