<!DOCTYPE html>
<html>
  <head>
    <title>Login - HPro Chat</title>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <style>
      body {
        font-family: Segoe UI, Arial, sans-serif;
        background-color: #252526;
        color: #ffffff;
        margin: 0;
        padding: 0;
        height: 100vh;
      }
      .menubar {
        background-color: #333333;
        padding: 2px 8px;
        border-bottom: 1px solid #3d3d3d;
        font-size: 12px;
      }
      .menubar span {
        color: #cccccc;
        padding: 4px 8px;
        cursor: default;
      }
      .login-container {
        width: 400px;
        margin: 100px auto;
        background-color: #2d2d2d;
        border: 1px solid #3d3d3d;
      }
      .header {
        background-color: #333333;
        padding: 8px 12px;
        border-bottom: 1px solid #3d3d3d;
        display: flex;
        align-items: center;
      }
      .header h1 {
        margin: 0;
        color: #cccccc;
        font-size: 12px;
        font-weight: normal;
      }
      .form-content {
        padding: 20px;
      }
      .form-group {
        margin-bottom: 16px;
      }
      label {
        display: block;
        margin-bottom: 4px;
        font-size: 12px;
        color: #cccccc;
      }
      input {
        width: 100%;
        padding: 6px 8px;
        border: 1px solid #3d3d3d;
        background-color: #3c3c3c;
        color: #ffffff;
        box-sizing: border-box;
        font-size: 12px;
        font-family: Consolas, monospace;
      }
      input:focus {
        outline: none;
        border-color: #007acc;
      }
      .button-container {
        display: flex;
        justify-content: flex-end;
        padding: 16px;
        background-color: #333333;
        border-top: 1px solid #3d3d3d;
      }
      button {
        padding: 6px 16px;
        background-color: #0e639c;
        color: white;
        border: 1px solid #0e639c;
        cursor: pointer;
        font-size: 12px;
      }
      button:hover {
        background-color: #1177bb;
      }
      .status-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: #007acc;
        padding: 2px 8px;
        font-size: 12px;
        color: white;
      }
      ::-webkit-scrollbar {
        width: 14px;
      }
      ::-webkit-scrollbar-track {
        background: #1e1e1e;
      }
      ::-webkit-scrollbar-thumb {
        background: #424242;
        border: 3px solid #1e1e1e;
        border-radius: 7px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #4f4f4f;
      }

      /* Design Responsivo para Mobile */
      @media (max-width: 768px) {
        .menubar {
          display: none;
        }

        .login-container {
          width: 90%;
          margin: 50px auto;
          max-width: 400px;
        }

        .header h1 {
          font-size: 14px;
        }

        .form-content {
          padding: 24px 16px;
        }

        label {
          font-size: 14px;
          margin-bottom: 8px;
        }

        input {
          padding: 12px;
          font-size: 16px;
          border-radius: 4px;
        }

        button {
          padding: 12px 24px;
          font-size: 14px;
          width: 100%;
          border-radius: 4px;
        }

        .button-container {
          padding: 16px;
        }

        .status-bar {
          font-size: 11px;
          padding: 4px 8px;
        }
      }

      @media (max-width: 480px) {
        .login-container {
          width: 95%;
          margin: 30px auto;
        }

        .header {
          padding: 12px;
        }

        .form-content {
          padding: 20px 12px;
        }
      }
    </style>
  </head>
  <body>
    <div class="menubar">
      <span>Arquivo</span>
      <span>Editar</span>
      <span>Projeto</span>
      <span>Ferramentas</span>
      <span>Ajuda</span>
    </div>
    <div class="login-container">
      <div class="header">
        <h1>Iniciar Nova Sessão de Depuração</h1>
      </div>
      <div class="form-content">
        <div id="login-form">
          <div class="form-group">
            <label>Nome do Usuário:</label>
            <input
              type="text"
              id="login-username"
              placeholder="Digite seu nome de usuário"
              autofocus
            />
          </div>
          <div class="form-group">
            <label>Senha:</label>
            <input
              type="password"
              id="login-password"
              placeholder="Digite sua senha"
            />
          </div>
          <div style="margin-top: 12px; font-size: 11px; color: #858585">
            Não tem uma conta?
            <a
              href="#"
              onclick="showRegister(); return false;"
              style="color: #007acc; text-decoration: none"
              >Registre-se</a
            >
          </div>
        </div>

        <div id="register-form" style="display: none">
          <div class="form-group">
            <label>Nome do Usuário:</label>
            <input
              type="text"
              id="register-username"
              placeholder="Escolha um nome de usuário (mín. 3 caracteres)"
            />
          </div>
          <div class="form-group">
            <label>Senha:</label>
            <input
              type="password"
              id="register-password"
              placeholder="Escolha uma senha (mín. 4 caracteres)"
            />
          </div>
          <div class="form-group">
            <label>Confirmar Senha:</label>
            <input
              type="password"
              id="register-confirm"
              placeholder="Digite a senha novamente"
            />
          </div>
          <div style="margin-top: 12px; font-size: 11px; color: #858585">
            Já tem uma conta?
            <a
              href="#"
              onclick="showLogin(); return false;"
              style="color: #007acc; text-decoration: none"
              >Faça login</a
            >
          </div>
        </div>
      </div>
      <div class="button-container">
        <button id="action-button" onclick="handleLogin()">Entrar</button>
      </div>
    </div>
    <div class="status-bar" id="status-bar">Pronto</div>

    <script>
      let isRegisterMode = false;

      function showRegister() {
        isRegisterMode = true;
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('register-form').style.display = 'block';
        document.getElementById('action-button').textContent = 'Registrar';
        document.getElementById('action-button').onclick = handleRegister;
        document.querySelector('.header h1').textContent = 'Criar Nova Conta';
        document.getElementById('register-username').focus();
      }

      function showLogin() {
        isRegisterMode = false;
        document.getElementById('login-form').style.display = 'block';
        document.getElementById('register-form').style.display = 'none';
        document.getElementById('action-button').textContent = 'Entrar';
        document.getElementById('action-button').onclick = handleLogin;
        document.querySelector('.header h1').textContent =
          'Iniciar Nova Sessão de Depuração';
        document.getElementById('login-username').focus();
      }

      function setStatus(message, isError = false) {
        const statusBar = document.getElementById('status-bar');
        statusBar.textContent = message;
        statusBar.style.backgroundColor = isError ? '#d32f2f' : '#007acc';

        if (!isError) {
          setTimeout(() => {
            statusBar.textContent = 'Pronto';
          }, 3000);
        }
      }

      async function handleLogin() {
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value.trim();

        if (!username || !password) {
          setStatus('Preencha todos os campos', true);
          return;
        }

        try {
          const response = await fetch('/authenticate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password }),
          });

          const data = await response.json();

          if (data.success) {
            localStorage.setItem('chatUsername', username);
            setStatus('Login realizado! Redirecionando...');
            setTimeout(() => {
              window.location.href = '/';
            }, 500);
          } else {
            setStatus(data.message, true);
          }
        } catch (error) {
          setStatus('Erro ao conectar com o servidor', true);
        }
      }

      async function handleRegister() {
        const username = document
          .getElementById('register-username')
          .value.trim();
        const password = document
          .getElementById('register-password')
          .value.trim();
        const confirm = document
          .getElementById('register-confirm')
          .value.trim();

        if (!username || !password || !confirm) {
          setStatus('Preencha todos os campos', true);
          return;
        }

        if (password !== confirm) {
          setStatus('As senhas não coincidem', true);
          return;
        }

        try {
          const response = await fetch('/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password }),
          });

          const data = await response.json();

          if (data.success) {
            setStatus(data.message);
            setTimeout(() => {
              showLogin();
              document.getElementById('login-username').value = username;
              document.getElementById('login-password').focus();
            }, 1500);
          } else {
            setStatus(data.message, true);
          }
        } catch (error) {
          setStatus('Erro ao conectar com o servidor', true);
        }
      }

      // Permite usar Enter
      document.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          if (isRegisterMode) {
            handleRegister();
          } else {
            handleLogin();
          }
        }
      });
    </script>
  </body>
</html>
